# RPS-robot

## 1. 项目背景与核心目标
**RPS-robot** 是一个基于计算机视觉和深度学习的“石头剪刀布”人机对战系统。
- **核心目标**：构建一个能够实时识别用户手势（石头/剪刀/布），并进行即时互动的智能系统。
- **项目特色**：利用轻量级神经网络（MLP）结合 MediaPipe 手部关键点检测技术，实现了低延迟、高精度的手势识别与游戏对战功能。

## 2. 主要功能模块及其相互关系

项目包含四个主要模块，形成完整的数据流闭环：

1.  **数据采集模块 (`collect.py`)**
    -   **功能**：调用摄像头捕捉手部画面，提取 21 个 3D 关键点坐标。
    -   **输出**：生成训练数据集 (`data/dataset.npy`, `data/labels.npy`)。
2.  **模型训练模块 (`train.py`)**
    -   **功能**：读取采集的数据，训练一个全连接神经网络（MLP）分类器。
    -   **输出**：训练好的模型权重文件 (`rps_mlp.pth`)。
3.  **实时测试模块 (`test.py`)**
    -   **功能**：加载模型进行实时推理，包含预测结果平滑处理（去抖动），用于验证模型效果。
4.  **对战游戏模块 (`realtime.py`)**
    -   **功能**：完整的游戏应用，包含“倒计时-出拳-判定”的游戏循环、计分系统以及 AI 必胜策略（针对用户出拳实时生成克制手势）。

## 3. 技术架构与关键组件

### 技术栈
-   **编程语言**：Python 3.x
-   **计算机视觉**：OpenCV (`cv2`), MediaPipe (Google 手部追踪方案)
-   **深度学习**：PyTorch
-   **数据处理**：NumPy, Scikit-learn

### 关键组件
-   **输入层**：63 维向量（21 个手部关键点 × 3 个坐标）。
-   **隐藏层**：2 层全连接层，每层 128 个神经元，ReLU 激活。
-   **输出层**：3 分类（Rock, Paper, Scissors）。

## 4. 部署环境要求与依赖项

### 硬件要求
-   **摄像头**：普通 USB 摄像头或笔记本自带摄像头。
-   **计算资源**：支持 CPU 推理（推荐），GPU 可选（PyTorch 支持 CUDA）。

### 软件依赖
请确保安装以下 Python 库：
```bash
pip install opencv-python mediapipe numpy torch scikit-learn
```
*(注：`mediapipe` 建议版本 0.8.x 或更高)*

## 5. 详细使用手册

### 步骤一：数据采集
1.  运行 `python collect.py`。
2.  程序会依次提示录制 `rock`, `paper`, `scissors`。
3.  **操作**：
    -   将手势对准摄像头。
    -   按键盘 **`s`** 开始录制（每一帧都会保存数据）。
    -   移动手部变换角度以增加数据多样性。
    -   按 **`q`** 结束当前手势录制，进入下一个。
4.  完成后数据保存在 `data/` 目录下。

### 步骤二：模型训练
1.  运行 `python train.py`。
2.  程序会自动加载数据，划分训练集/测试集。
3.  训练 80 个 Epoch，并在控制台输出 Loss 和准确率报告。
4.  生成的模型保存在 `rps_mlp.pth`。

### 步骤三：启动应用
-   **模式 A：实时测试（推荐调试用）**
    运行 `python test.py`。
    -   实时显示当前手势识别结果。
    -   包含平滑处理，画面更稳定。
-   **模式 B：人机对战（推荐体验用）**
    运行 `python realtime.py`。
    -   进入游戏循环：3秒倒计时 -> 玩家出拳 -> AI 出拳（根据玩家手势判定输赢） -> 显示结果 -> 更新比分。
    -   按 `Q` 退出。

## 6. API 接口文档 (内部核心函数)

虽然本项目主要是脚本运行，但核心类 `MLP` 可复用。

### `MLP` 类 (在 `train.py`, `realtime.py` 中定义)
```python
class MLP(nn.Module):
    def __init__(self, in_dim, hidden, num_classes):
        """
        初始化多层感知机
        Args:
            in_dim (int): 输入特征维度 (通常为 63)
            hidden (int): 隐藏层神经元数量 (如 128)
            num_classes (int): 分类数量 (3)
        """
    def forward(self, x):
        """前向传播，返回未归一化的 logits"""
```


## 7. 性能指标与扩展方案
-   **性能**：
    -   推理速度：CPU 下 < 10ms/帧，完全满足 30FPS 实时要求。
    -   准确率：在采集约 500-1000 张样本的情况下，测试集准确率通常 > 95%。

